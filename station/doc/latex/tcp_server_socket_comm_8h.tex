\hypertarget{tcp_server_socket_comm_8h}{}\section{ras\+Pi-\/\+Emergency\+Station/tcp\+Server\+Socket\+Comm.h File Reference}
\label{tcp_server_socket_comm_8h}\index{ras\+Pi-\/\+Emergency\+Station/tcp\+Server\+Socket\+Comm.\+h@{ras\+Pi-\/\+Emergency\+Station/tcp\+Server\+Socket\+Comm.\+h}}


Server connection related function definitions.  


{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$netinet/in.\+h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$netdb.\+h$>$}\\*
{\ttfamily \#include \char`\"{}structures.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}msg\+Buffers.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}message\+Parser.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tcp_server_socket_comm_8h_a129b09429d113acb51cfdd588a5813ec}{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS}~\char`\"{}ayerdi\char`\"{}
\item 
\#define \hyperlink{tcp_server_socket_comm_8h_a7ad7354d7e5952d98174c0567a5d5feb}{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}~5000
\item 
\#define \hyperlink{tcp_server_socket_comm_8h_ab492d14b137163790b6b38fd9184cda4}{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN}~1024
\item 
\#define \hyperlink{tcp_server_socket_comm_8h_a54a7ebfc80906662a1d6011d2401e269}{S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN}~1020
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tcp_server_socket_comm_8h_a71368ed7199c8c4f010605207359f972}{S\+S\+C\+\_\+make\+Server\+Connection} ()
\begin{DoxyCompactList}\small\item\em Create the connection to the server. \end{DoxyCompactList}\item 
void \hyperlink{tcp_server_socket_comm_8h_a64aaa41ac5e2fbe7f8ba88c053b49ff9}{S\+S\+C\+\_\+init\+Server\+Connection} ()
\begin{DoxyCompactList}\small\item\em Initialize the connection to the server. \end{DoxyCompactList}\item 
void \hyperlink{tcp_server_socket_comm_8h_ae12d709dd8d0c5c39e8949dfa433dff4}{S\+S\+C\+\_\+init\+Buffers} ()
\begin{DoxyCompactList}\small\item\em Initialize the buffers involved in the server communication. \end{DoxyCompactList}\item 
void \hyperlink{tcp_server_socket_comm_8h_a4207c38ca4a5d4585ba185514a38f594}{S\+S\+C\+\_\+send\+Message\+To\+Server} (struct \hyperlink{struct_m_e_s_s_a_g_e}{M\+E\+S\+S\+A\+GE} $\ast$msg)
\item 
void \hyperlink{tcp_server_socket_comm_8h_a764e95eb0d9780103d96fe17901cafae}{S\+S\+C\+\_\+stop\+Server\+Conn} ()
\begin{DoxyCompactList}\small\item\em Shutdown the connection to the server. \end{DoxyCompactList}\item 
void \hyperlink{tcp_server_socket_comm_8h_aefcfff31ea3a9b0d92a83ab83c9874f9}{S\+S\+C\+\_\+init\+Server\+Conn\+Threads} ()
\begin{DoxyCompactList}\small\item\em Start the threads for listening and sending messages to the server. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{tcp_server_socket_comm_8h_ab46f3e041cae487562197067e220af3b}{S\+S\+C\+\_\+msg\+Sender\+Thread\+Func} (void $\ast$args)
\begin{DoxyCompactList}\small\item\em Thread to send the messages stored in the outbox to the server. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{tcp_server_socket_comm_8h_ae54218394dd621113d0f73ec6ef8f873}{S\+S\+C\+\_\+msg\+Listener\+Thread\+Func} (void $\ast$args)
\begin{DoxyCompactList}\small\item\em Thread to listen to messages coming from the server. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{struct_s_s_c___s_t_a_t}{S\+S\+C\+\_\+\+S\+T\+AT} \hyperlink{tcp_server_socket_comm_8h_a14f5752a27e37a812a55657f99b0408d}{server\+Socket\+Stat}
\begin{DoxyCompactList}\small\item\em Structure containing all the parameters for the connection to the server and it\textquotesingle{}s state. \end{DoxyCompactList}\item 
\hyperlink{structures_8h_ad63ff8138c416e3817bf5e9ddc033007}{P\+M\+S\+G\+B\+U\+FF} \hyperlink{tcp_server_socket_comm_8h_a4a90a0c7abbee73d223b3d00b3f46454}{S\+S\+C\+\_\+server\+Send\+Buffer}
\begin{DoxyCompactList}\small\item\em Outbox for the messages to be sent to the server. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Server connection related function definitions. 



\subsection{Macro Definition Documentation}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN@{S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN}}
\index{S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN@{S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN}{SSC_RCV_MAXLEN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+S\+C\+\_\+\+R\+C\+V\+\_\+\+M\+A\+X\+L\+EN~1020}\hypertarget{tcp_server_socket_comm_8h_a54a7ebfc80906662a1d6011d2401e269}{}\label{tcp_server_socket_comm_8h_a54a7ebfc80906662a1d6011d2401e269}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS}}
\index{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS}{SSC_SRV_ADDRESS}}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+A\+D\+D\+R\+E\+SS~\char`\"{}ayerdi\char`\"{}}\hypertarget{tcp_server_socket_comm_8h_a129b09429d113acb51cfdd588a5813ec}{}\label{tcp_server_socket_comm_8h_a129b09429d113acb51cfdd588a5813ec}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN}}
\index{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN}{SSC_SRV_BUFLEN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+B\+U\+F\+L\+EN~1024}\hypertarget{tcp_server_socket_comm_8h_ab492d14b137163790b6b38fd9184cda4}{}\label{tcp_server_socket_comm_8h_ab492d14b137163790b6b38fd9184cda4}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}}
\index{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT@{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}{SSC_SRV_PORT}}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT~5000}\hypertarget{tcp_server_socket_comm_8h_a7ad7354d7e5952d98174c0567a5d5feb}{}\label{tcp_server_socket_comm_8h_a7ad7354d7e5952d98174c0567a5d5feb}


\subsection{Function Documentation}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+init\+Buffers@{S\+S\+C\+\_\+init\+Buffers}}
\index{S\+S\+C\+\_\+init\+Buffers@{S\+S\+C\+\_\+init\+Buffers}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+init\+Buffers()}{SSC_initBuffers()}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+init\+Buffers (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_ae12d709dd8d0c5c39e8949dfa433dff4}{}\label{tcp_server_socket_comm_8h_ae12d709dd8d0c5c39e8949dfa433dff4}


Initialize the buffers involved in the server communication. 

\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+init\+Server\+Connection@{S\+S\+C\+\_\+init\+Server\+Connection}}
\index{S\+S\+C\+\_\+init\+Server\+Connection@{S\+S\+C\+\_\+init\+Server\+Connection}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+init\+Server\+Connection()}{SSC_initServerConnection()}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+init\+Server\+Connection (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_a64aaa41ac5e2fbe7f8ba88c053b49ff9}{}\label{tcp_server_socket_comm_8h_a64aaa41ac5e2fbe7f8ba88c053b49ff9}


Initialize the connection to the server. 

Initializes the sockets and resolves the D\+NS name of the server to connect to. It then calls the other functions to continue the initialization. \index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+init\+Server\+Conn\+Threads@{S\+S\+C\+\_\+init\+Server\+Conn\+Threads}}
\index{S\+S\+C\+\_\+init\+Server\+Conn\+Threads@{S\+S\+C\+\_\+init\+Server\+Conn\+Threads}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+init\+Server\+Conn\+Threads()}{SSC_initServerConnThreads()}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+init\+Server\+Conn\+Threads (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_aefcfff31ea3a9b0d92a83ab83c9874f9}{}\label{tcp_server_socket_comm_8h_aefcfff31ea3a9b0d92a83ab83c9874f9}


Start the threads for listening and sending messages to the server. 

\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+make\+Server\+Connection@{S\+S\+C\+\_\+make\+Server\+Connection}}
\index{S\+S\+C\+\_\+make\+Server\+Connection@{S\+S\+C\+\_\+make\+Server\+Connection}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+make\+Server\+Connection()}{SSC_makeServerConnection()}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+make\+Server\+Connection (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_a71368ed7199c8c4f010605207359f972}{}\label{tcp_server_socket_comm_8h_a71368ed7199c8c4f010605207359f972}


Create the connection to the server. 

Tryes to connect to the server. If the connection fails. Waits for a time period wthich grows exponentially. \index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+msg\+Listener\+Thread\+Func@{S\+S\+C\+\_\+msg\+Listener\+Thread\+Func}}
\index{S\+S\+C\+\_\+msg\+Listener\+Thread\+Func@{S\+S\+C\+\_\+msg\+Listener\+Thread\+Func}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+msg\+Listener\+Thread\+Func(void $\ast$args)}{SSC_msgListenerThreadFunc(void *args)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ S\+S\+C\+\_\+msg\+Listener\+Thread\+Func (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{args}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_ae54218394dd621113d0f73ec6ef8f873}{}\label{tcp_server_socket_comm_8h_ae54218394dd621113d0f73ec6ef8f873}


Thread to listen to messages coming from the server. 

It waits for new messages to arrive. If the connection has failed, tryes to reconnect to the server. \index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+msg\+Sender\+Thread\+Func@{S\+S\+C\+\_\+msg\+Sender\+Thread\+Func}}
\index{S\+S\+C\+\_\+msg\+Sender\+Thread\+Func@{S\+S\+C\+\_\+msg\+Sender\+Thread\+Func}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+msg\+Sender\+Thread\+Func(void $\ast$args)}{SSC_msgSenderThreadFunc(void *args)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ S\+S\+C\+\_\+msg\+Sender\+Thread\+Func (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{args}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_ab46f3e041cae487562197067e220af3b}{}\label{tcp_server_socket_comm_8h_ab46f3e041cae487562197067e220af3b}


Thread to send the messages stored in the outbox to the server. 

It waits for messages to be put in the server\textquotesingle{}s outbox and sends these when they are available. \index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+send\+Message\+To\+Server@{S\+S\+C\+\_\+send\+Message\+To\+Server}}
\index{S\+S\+C\+\_\+send\+Message\+To\+Server@{S\+S\+C\+\_\+send\+Message\+To\+Server}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+send\+Message\+To\+Server(struct M\+E\+S\+S\+A\+G\+E $\ast$msg)}{SSC_sendMessageToServer(struct MESSAGE *msg)}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+send\+Message\+To\+Server (
\begin{DoxyParamCaption}
\item[{struct {\bf M\+E\+S\+S\+A\+GE} $\ast$}]{msg}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_a4207c38ca4a5d4585ba185514a38f594}{}\label{tcp_server_socket_comm_8h_a4207c38ca4a5d4585ba185514a38f594}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+stop\+Server\+Conn@{S\+S\+C\+\_\+stop\+Server\+Conn}}
\index{S\+S\+C\+\_\+stop\+Server\+Conn@{S\+S\+C\+\_\+stop\+Server\+Conn}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+stop\+Server\+Conn()}{SSC_stopServerConn()}}]{\setlength{\rightskip}{0pt plus 5cm}void S\+S\+C\+\_\+stop\+Server\+Conn (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_server_socket_comm_8h_a764e95eb0d9780103d96fe17901cafae}{}\label{tcp_server_socket_comm_8h_a764e95eb0d9780103d96fe17901cafae}


Shutdown the connection to the server. 

It tryes to shutdown and close the socket gracefully. It then wait to the threads to exit by sending them a stop condition. 

\subsection{Variable Documentation}
\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!server\+Socket\+Stat@{server\+Socket\+Stat}}
\index{server\+Socket\+Stat@{server\+Socket\+Stat}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{server\+Socket\+Stat}{serverSocketStat}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+S\+C\+\_\+\+S\+T\+AT} server\+Socket\+Stat}\hypertarget{tcp_server_socket_comm_8h_a14f5752a27e37a812a55657f99b0408d}{}\label{tcp_server_socket_comm_8h_a14f5752a27e37a812a55657f99b0408d}


Structure containing all the parameters for the connection to the server and it\textquotesingle{}s state. 

\index{tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}!S\+S\+C\+\_\+server\+Send\+Buffer@{S\+S\+C\+\_\+server\+Send\+Buffer}}
\index{S\+S\+C\+\_\+server\+Send\+Buffer@{S\+S\+C\+\_\+server\+Send\+Buffer}!tcp\+Server\+Socket\+Comm.\+h@{tcp\+Server\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{S\+S\+C\+\_\+server\+Send\+Buffer}{SSC_serverSendBuffer}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf P\+M\+S\+G\+B\+U\+FF} S\+S\+C\+\_\+server\+Send\+Buffer}\hypertarget{tcp_server_socket_comm_8h_a4a90a0c7abbee73d223b3d00b3f46454}{}\label{tcp_server_socket_comm_8h_a4a90a0c7abbee73d223b3d00b3f46454}


Outbox for the messages to be sent to the server. 

