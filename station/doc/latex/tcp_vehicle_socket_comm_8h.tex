\hypertarget{tcp_vehicle_socket_comm_8h}{}\section{ras\+Pi-\/\+Emergency\+Station/tcp\+Vehicle\+Socket\+Comm.h File Reference}
\label{tcp_vehicle_socket_comm_8h}\index{ras\+Pi-\/\+Emergency\+Station/tcp\+Vehicle\+Socket\+Comm.\+h@{ras\+Pi-\/\+Emergency\+Station/tcp\+Vehicle\+Socket\+Comm.\+h}}


Vehicle connection server\textquotesingle{}s headers.  


{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$netinet/in.\+h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$netdb.\+h$>$}\\*
{\ttfamily \#include \char`\"{}structures.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}msg\+Buffers.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}message\+Parser.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}station\+Actions.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tcp_vehicle_socket_comm_8h_a598b254727449d2497c9246f8802694d}{V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}~6000
\begin{DoxyCompactList}\small\item\em Port of where the vehicle connection server will listen definition. \end{DoxyCompactList}\item 
\#define \hyperlink{tcp_vehicle_socket_comm_8h_a273ec2e27c00bbfc1a2c8d334bfb3cda}{V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG}~10
\begin{DoxyCompactList}\small\item\em Max pending messages definition. \end{DoxyCompactList}\item 
\#define \hyperlink{tcp_vehicle_socket_comm_8h_af913d826f2e3ef7dab5fdb8030978513}{V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN}~512
\begin{DoxyCompactList}\small\item\em Size of the receiver buffer. \end{DoxyCompactList}\item 
\#define \hyperlink{tcp_vehicle_socket_comm_8h_a43eb2cb699f41a78b3c96b034dac51e9}{V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN}~510
\begin{DoxyCompactList}\small\item\em Max size of the received messages stored in the buffer. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tcp_vehicle_socket_comm_8h_a49fe9e8bc1bd13ac909ae2b7d2391886}{V\+S\+C\+\_\+init\+Vehicle\+Server} ()
\begin{DoxyCompactList}\small\item\em Initialize the vehicle comunication server. \end{DoxyCompactList}\item 
void \hyperlink{tcp_vehicle_socket_comm_8h_a3ec3f2c1297ab45cb0ad39f925a4bce5}{V\+S\+C\+\_\+accept\+Connections} ()
\begin{DoxyCompactList}\small\item\em Accept the new connections from vehicles. \end{DoxyCompactList}\item 
void \hyperlink{tcp_vehicle_socket_comm_8h_ad670ed989fdade07d91fd3f1bc38ae03}{V\+S\+C\+\_\+shutdown\+Vehicle\+Server} ()
\begin{DoxyCompactList}\small\item\em Shutdown the vehicle comunication server. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{tcp_vehicle_socket_comm_8h_a919ad3564e41afca64d17244390cfba7}{V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func} (void $\ast$args)
\begin{DoxyCompactList}\small\item\em Thread to handle the inbound messages from the vehicles. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{tcp_vehicle_socket_comm_8h_a8a9cd2f1bfdc3aada6f66fbddee2aa39}{V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func} (void $\ast$args)
\begin{DoxyCompactList}\small\item\em Thread to send the messages to the vehicle. \end{DoxyCompactList}\item 
int \hyperlink{tcp_vehicle_socket_comm_8h_ab11d138f26a1dd8226ab5bca29cfdbbc}{V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle} (struct \hyperlink{struct_m_e_s_s_a_g_e}{M\+E\+S\+S\+A\+GE} $\ast$msg, struct \hyperlink{struct_s_a___v_e_h_i_c_l_e___d_a_t_a}{S\+A\+\_\+\+V\+E\+H\+I\+C\+L\+E\+\_\+\+D\+A\+TA} $\ast$vehicle)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{struct_v_s_c___s_t_a_t}{V\+S\+C\+\_\+\+S\+T\+AT} \hyperlink{tcp_vehicle_socket_comm_8h_a4761d6baa79afa32a3cffc33901bbd55}{vehicle\+Server\+Stat}
\begin{DoxyCompactList}\small\item\em Structure containing all the parameters and the status of the vehicle server. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Vehicle connection server\textquotesingle{}s headers. 



\subsection{Macro Definition Documentation}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG@{V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG}}
\index{V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG@{V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG}{VSC_MAXPENDING}}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+S\+C\+\_\+\+M\+A\+X\+P\+E\+N\+D\+I\+NG~10}\hypertarget{tcp_vehicle_socket_comm_8h_a273ec2e27c00bbfc1a2c8d334bfb3cda}{}\label{tcp_vehicle_socket_comm_8h_a273ec2e27c00bbfc1a2c8d334bfb3cda}


Max pending messages definition. 

\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN@{V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN}}
\index{V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN@{V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN}{VSC_MAXRCV_LEN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+S\+C\+\_\+\+M\+A\+X\+R\+C\+V\+\_\+\+L\+EN~510}\hypertarget{tcp_vehicle_socket_comm_8h_a43eb2cb699f41a78b3c96b034dac51e9}{}\label{tcp_vehicle_socket_comm_8h_a43eb2cb699f41a78b3c96b034dac51e9}


Max size of the received messages stored in the buffer. 

\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN@{V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN}}
\index{V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN@{V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN}{VSC_SOCKBUF_LEN}}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+S\+C\+\_\+\+S\+O\+C\+K\+B\+U\+F\+\_\+\+L\+EN~512}\hypertarget{tcp_vehicle_socket_comm_8h_af913d826f2e3ef7dab5fdb8030978513}{}\label{tcp_vehicle_socket_comm_8h_af913d826f2e3ef7dab5fdb8030978513}


Size of the receiver buffer. 

\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT@{V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}}
\index{V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT@{V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT}{VSC_SRV_PORT}}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+S\+C\+\_\+\+S\+R\+V\+\_\+\+P\+O\+RT~6000}\hypertarget{tcp_vehicle_socket_comm_8h_a598b254727449d2497c9246f8802694d}{}\label{tcp_vehicle_socket_comm_8h_a598b254727449d2497c9246f8802694d}


Port of where the vehicle connection server will listen definition. 



\subsection{Function Documentation}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+accept\+Connections@{V\+S\+C\+\_\+accept\+Connections}}
\index{V\+S\+C\+\_\+accept\+Connections@{V\+S\+C\+\_\+accept\+Connections}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+accept\+Connections()}{VSC_acceptConnections()}}]{\setlength{\rightskip}{0pt plus 5cm}void V\+S\+C\+\_\+accept\+Connections (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_a3ec3f2c1297ab45cb0ad39f925a4bce5}{}\label{tcp_vehicle_socket_comm_8h_a3ec3f2c1297ab45cb0ad39f925a4bce5}


Accept the new connections from vehicles. 

It accepts the new connection and creates a new thread to listen for the messages from them. \index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func@{V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func}}
\index{V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func@{V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func(void $\ast$args)}{VSC_inboundHandlerThreadFunc(void *args)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ V\+S\+C\+\_\+inbound\+Handler\+Thread\+Func (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{args}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_a919ad3564e41afca64d17244390cfba7}{}\label{tcp_vehicle_socket_comm_8h_a919ad3564e41afca64d17244390cfba7}


Thread to handle the inbound messages from the vehicles. 

When a new connection arrives, in the first message sets the handling thread as itself to assign itself as the handling thread to add it to the vehicle structure after the id is know when parsing the message. When a disconnection occurs, marks that vehicle as disconnected and the thread exits. 
\begin{DoxyParams}{Parameters}
{\em args} & The client socket number. \\
\hline
\end{DoxyParams}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+init\+Vehicle\+Server@{V\+S\+C\+\_\+init\+Vehicle\+Server}}
\index{V\+S\+C\+\_\+init\+Vehicle\+Server@{V\+S\+C\+\_\+init\+Vehicle\+Server}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+init\+Vehicle\+Server()}{VSC_initVehicleServer()}}]{\setlength{\rightskip}{0pt plus 5cm}void V\+S\+C\+\_\+init\+Vehicle\+Server (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_a49fe9e8bc1bd13ac909ae2b7d2391886}{}\label{tcp_vehicle_socket_comm_8h_a49fe9e8bc1bd13ac909ae2b7d2391886}


Initialize the vehicle comunication server. 

It initializes the needed sockets, binds to an interface and listens for connections. \index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func@{V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func}}
\index{V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func@{V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func(void $\ast$args)}{VSC_outboundHandlerThreadFunc(void *args)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ V\+S\+C\+\_\+outbound\+Handler\+Thread\+Func (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{args}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_a8a9cd2f1bfdc3aada6f66fbddee2aa39}{}\label{tcp_vehicle_socket_comm_8h_a8a9cd2f1bfdc3aada6f66fbddee2aa39}


Thread to send the messages to the vehicle. 

It waits for the messages to arrive at the vehicle\textquotesingle{}s outbox and sends them. 
\begin{DoxyParams}{Parameters}
{\em args} & The vehicle structure with all his information. \\
\hline
\end{DoxyParams}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle@{V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle}}
\index{V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle@{V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle(struct M\+E\+S\+S\+A\+G\+E $\ast$msg, struct S\+A\+\_\+\+V\+E\+H\+I\+C\+L\+E\+\_\+\+D\+A\+T\+A $\ast$vehicle)}{VSC_SendMessageToVehicle(struct MESSAGE *msg, struct SA_VEHICLE_DATA *vehicle)}}]{\setlength{\rightskip}{0pt plus 5cm}int V\+S\+C\+\_\+\+Send\+Message\+To\+Vehicle (
\begin{DoxyParamCaption}
\item[{struct {\bf M\+E\+S\+S\+A\+GE} $\ast$}]{msg, }
\item[{struct {\bf S\+A\+\_\+\+V\+E\+H\+I\+C\+L\+E\+\_\+\+D\+A\+TA} $\ast$}]{vehicle}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_ab11d138f26a1dd8226ab5bca29cfdbbc}{}\label{tcp_vehicle_socket_comm_8h_ab11d138f26a1dd8226ab5bca29cfdbbc}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!V\+S\+C\+\_\+shutdown\+Vehicle\+Server@{V\+S\+C\+\_\+shutdown\+Vehicle\+Server}}
\index{V\+S\+C\+\_\+shutdown\+Vehicle\+Server@{V\+S\+C\+\_\+shutdown\+Vehicle\+Server}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{V\+S\+C\+\_\+shutdown\+Vehicle\+Server()}{VSC_shutdownVehicleServer()}}]{\setlength{\rightskip}{0pt plus 5cm}void V\+S\+C\+\_\+shutdown\+Vehicle\+Server (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{tcp_vehicle_socket_comm_8h_ad670ed989fdade07d91fd3f1bc38ae03}{}\label{tcp_vehicle_socket_comm_8h_ad670ed989fdade07d91fd3f1bc38ae03}


Shutdown the vehicle comunication server. 

It tryes to shutdown the vehicle communication server gracefully by shutting down the sockets, setting an exit condition to the threads and waiting for them to exit. 

\subsection{Variable Documentation}
\index{tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}!vehicle\+Server\+Stat@{vehicle\+Server\+Stat}}
\index{vehicle\+Server\+Stat@{vehicle\+Server\+Stat}!tcp\+Vehicle\+Socket\+Comm.\+h@{tcp\+Vehicle\+Socket\+Comm.\+h}}
\subsubsection[{\texorpdfstring{vehicle\+Server\+Stat}{vehicleServerStat}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf V\+S\+C\+\_\+\+S\+T\+AT} vehicle\+Server\+Stat}\hypertarget{tcp_vehicle_socket_comm_8h_a4761d6baa79afa32a3cffc33901bbd55}{}\label{tcp_vehicle_socket_comm_8h_a4761d6baa79afa32a3cffc33901bbd55}


Structure containing all the parameters and the status of the vehicle server. 

