<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Skynet - Emergency station: rasPi-EmergencyStation/tcpVehicleSocketComm.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Skynet - Emergency station
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Application for managing the communications between server and vehicles</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tcp_vehicle_socket_comm_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">tcpVehicleSocketComm.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Vehicle connection server related function definitions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="tcp_vehicle_socket_comm_8h_source.html">tcpVehicleSocketComm.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a49fe9e8bc1bd13ac909ae2b7d2391886"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a49fe9e8bc1bd13ac909ae2b7d2391886">VSC_initVehicleServer</a> ()</td></tr>
<tr class="memdesc:a49fe9e8bc1bd13ac909ae2b7d2391886"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the vehicle comunication server.  <a href="#a49fe9e8bc1bd13ac909ae2b7d2391886">More...</a><br /></td></tr>
<tr class="separator:a49fe9e8bc1bd13ac909ae2b7d2391886"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ec3f2c1297ab45cb0ad39f925a4bce5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a3ec3f2c1297ab45cb0ad39f925a4bce5">VSC_acceptConnections</a> ()</td></tr>
<tr class="memdesc:a3ec3f2c1297ab45cb0ad39f925a4bce5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accept the new connections from vehicles.  <a href="#a3ec3f2c1297ab45cb0ad39f925a4bce5">More...</a><br /></td></tr>
<tr class="separator:a3ec3f2c1297ab45cb0ad39f925a4bce5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad670ed989fdade07d91fd3f1bc38ae03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#ad670ed989fdade07d91fd3f1bc38ae03">VSC_shutdownVehicleServer</a> ()</td></tr>
<tr class="memdesc:ad670ed989fdade07d91fd3f1bc38ae03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shutdown the vehicle comunication server.  <a href="#ad670ed989fdade07d91fd3f1bc38ae03">More...</a><br /></td></tr>
<tr class="separator:ad670ed989fdade07d91fd3f1bc38ae03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a919ad3564e41afca64d17244390cfba7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a919ad3564e41afca64d17244390cfba7">VSC_inboundHandlerThreadFunc</a> (void *args)</td></tr>
<tr class="memdesc:a919ad3564e41afca64d17244390cfba7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread to handle the inbound messages from the vehicles.  <a href="#a919ad3564e41afca64d17244390cfba7">More...</a><br /></td></tr>
<tr class="separator:a919ad3564e41afca64d17244390cfba7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a9cd2f1bfdc3aada6f66fbddee2aa39"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a8a9cd2f1bfdc3aada6f66fbddee2aa39">VSC_outboundHandlerThreadFunc</a> (void *args)</td></tr>
<tr class="memdesc:a8a9cd2f1bfdc3aada6f66fbddee2aa39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread to send the messages to the vehicle.  <a href="#a8a9cd2f1bfdc3aada6f66fbddee2aa39">More...</a><br /></td></tr>
<tr class="separator:a8a9cd2f1bfdc3aada6f66fbddee2aa39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c76ab448a30a8498f76e22546c81047"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a1c76ab448a30a8498f76e22546c81047">VSC_SendMessageToVehicle</a> (<a class="el" href="structures_8h.html#ab0e2403c2d12c3cd1b983b120f9d29f7">PMESSAGE</a> msg, <a class="el" href="structures_8h.html#ab60a043206ae138fbd2fd16397e926a6">SA_PVEHICLE_DATA</a> vehicle)</td></tr>
<tr class="memdesc:a1c76ab448a30a8498f76e22546c81047"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a message to a vehicle.  <a href="#a1c76ab448a30a8498f76e22546c81047">More...</a><br /></td></tr>
<tr class="separator:a1c76ab448a30a8498f76e22546c81047"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4761d6baa79afa32a3cffc33901bbd55"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_v_s_c___s_t_a_t.html">VSC_STAT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tcp_vehicle_socket_comm_8c.html#a4761d6baa79afa32a3cffc33901bbd55">vehicleServerStat</a></td></tr>
<tr class="memdesc:a4761d6baa79afa32a3cffc33901bbd55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure containing all the parameters and the status of the vehicle server.  <a href="#a4761d6baa79afa32a3cffc33901bbd55">More...</a><br /></td></tr>
<tr class="separator:a4761d6baa79afa32a3cffc33901bbd55"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Vehicle connection server related function definitions. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3ec3f2c1297ab45cb0ad39f925a4bce5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VSC_acceptConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Accept the new connections from vehicles. </p>
<p>It accepts the new connection and creates a new thread to listen for the messages from them. </p>

</div>
</div>
<a class="anchor" id="a919ad3564e41afca64d17244390cfba7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* VSC_inboundHandlerThreadFunc </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread to handle the inbound messages from the vehicles. </p>
<p>When a new connection arrives, in the first message sets the handling thread as itself to assign itself as the handling thread to add it to the vehicle structure after the id is know when parsing the message. When a disconnection occurs, marks that vehicle as disconnected and the thread exits. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">args</td><td>The client socket number. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a49fe9e8bc1bd13ac909ae2b7d2391886"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VSC_initVehicleServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the vehicle comunication server. </p>
<p>It initializes the needed sockets, binds to an interface and listens for connections. </p>

</div>
</div>
<a class="anchor" id="a8a9cd2f1bfdc3aada6f66fbddee2aa39"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* VSC_outboundHandlerThreadFunc </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread to send the messages to the vehicle. </p>
<p>It waits for the messages to arrive at the vehicle's outbox and sends them. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">args</td><td>The vehicle structure with all his information. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1c76ab448a30a8498f76e22546c81047"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int VSC_SendMessageToVehicle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structures_8h.html#ab0e2403c2d12c3cd1b983b120f9d29f7">PMESSAGE</a>&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structures_8h.html#ab60a043206ae138fbd2fd16397e926a6">SA_PVEHICLE_DATA</a>&#160;</td>
          <td class="paramname"><em>vehicle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a message to a vehicle. </p>
<p>It sends a message to the specified vehicle. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The message to be sent. </td></tr>
    <tr><td class="paramname">vehicle</td><td>The vehicle to send the message to. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the message was correctly sended, returns 0. -1 If an error occurred. </dd></dl>

</div>
</div>
<a class="anchor" id="ad670ed989fdade07d91fd3f1bc38ae03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VSC_shutdownVehicleServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shutdown the vehicle comunication server. </p>
<p>It tryes to shutdown the vehicle communication server gracefully by shutting down the sockets, setting an exit condition to the threads and waiting for them to exit. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a4761d6baa79afa32a3cffc33901bbd55"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_v_s_c___s_t_a_t.html">VSC_STAT</a> vehicleServerStat</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Structure containing all the parameters and the status of the vehicle server. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d79aaa2833e99619ba276a6f7310bac1.html">rasPi-EmergencyStation</a></li><li class="navelem"><a class="el" href="tcp_vehicle_socket_comm_8c.html">tcpVehicleSocketComm.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
